# Foreign key/best practice attribute for sync with other todo systems

**Status:** Done
**Created:** 2025-12-20-23-52-50
**Started:** 2025-12-20-23-56-12
**Agent PID:** 98482

## Description

Add optional `externalId` field to TodoAlpha3 to enable periodic import sync from GitHub issues. The field will store foreign keys in format "github:owner/repo/issues/number" for imported todos, while Eddo-created todos will have `null` or `undefined`.

**Success criteria:**

- TodoAlpha3 interface includes `externalId?: string | null`
- MCP server supports creating todos with externalId
- MCP server can filter todos by externalId (for deduplication during import)
- Existing todos work without the field (backwards compatible)
- All tests pass with updated data model

## Implementation Plan

- [x] Add `externalId?: string | null` to TodoAlpha3 interface (packages/core-shared/src/versions/todo_alpha3.ts)
- [x] Update isTodoAlpha3 type guard to handle optional externalId
- [x] Update MCP server createTodo tool to accept optional externalId parameter
- [x] Update MCP server listTodos to support filtering by externalId prefix (e.g., "github:")
- [x] Add utility function to parse/validate GitHub issue IDs (packages/core-shared/src/utils/parse_github_issue_id.ts)
- [x] Update mock data generators to include externalId examples
- [x] Automated test: MCP server creates todo with externalId
- [x] Automated test: MCP server filters by externalId
- [x] Automated test: GitHub ID parsing/validation utility
- [x] Automated test: Existing mock todos without externalId still work
- [x] User test: Create todo via MCP with externalId, verify in web UI
- [x] User test: Verify existing todos still work (backwards compatibility)

## Review

- [x] Added externalId field to web UI edit modal
- [x] Added tests for externalId field editing (2 new tests)
- [x] All tests pass (450 tests total)

## Notes

**Implementation Details:**

- Added `externalId?: string | null` to TodoAlpha3 interface (optional, backwards compatible)
- Updated migration function to set `externalId: null` for migrated todos
- Extended MCP server:
  - createTodo: accepts optional `externalId` parameter
  - listTodos: supports exact match filtering by `externalId`
  - Note: Prefix matching (e.g., "github:") requires CouchDB index - reserved for future enhancement
- Created GitHub issue ID parsing/validation utilities:
  - `parseGitHubIssueId()` - parses "github:owner/repo/issues/number" format
  - `formatGitHubIssueId()` - formats components into external ID
  - `isGitHubIssueId()` - validates format
- Updated mock data generators with GitHub issue examples
- Added externalId field to TodoEditModal component for manual editing
  - Field appears between "Link" and "Tags"
  - Placeholder text: "github:owner/repo/issues/123"
  - Supports null/empty values (clears externalId when emptied)
  - Added 2 comprehensive tests for field behavior
- All tests pass (450 tests total: unit + integration + e2e)
- Production build successful
